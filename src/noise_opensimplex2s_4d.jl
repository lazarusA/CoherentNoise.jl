using ..OpenSimplex2Noise: GRADIENTS_NORMALIZED_4D

struct Vertex4D
    XYZW::NTuple{4,UInt64}
    xyzw::NTuple{4,Float64}
    function Vertex4D(x::T, y::T, z::T, w::T) where {T<:Int}
        s = (x + y + z + w) * UNSKEW_4D
        XYZW = (x, y, z, w) .* (PRIME_X, PRIME_Y, PRIME_Z, PRIME_W)
        xyzw = .-((x, y, z, w)) .- s
        new(XYZW, xyzw)
    end
end

const SKEW_4D = 0.309016994374947
const UNSKEW_4D = -0.138196601125011
const R²4D = 4 / 5
const GRADIENTS_4D = GRADIENTS_NORMALIZED_4D ./ 0.11127401889945551 |> CircularVector
const VERTICES_4D = [
    [0x15 0x45 0x51 0x54 0x55 0x56 0x59 0x5a 0x65 0x66 0x69 0x6a 0x95 0x96 0x99 0x9a 0xa5 0xa6 0xa9 0xaa],
    [0x15 0x45 0x51 0x55 0x56 0x59 0x5a 0x65 0x66 0x6a 0x95 0x96 0x9a 0xa6 0xaa],
    [0x01 0x05 0x11 0x15 0x41 0x45 0x51 0x55 0x56 0x5a 0x66 0x6a 0x96 0x9a 0xa6 0xaa],
    [0x01 0x15 0x16 0x45 0x46 0x51 0x52 0x55 0x56 0x5a 0x66 0x6a 0x96 0x9a 0xa6 0xaa 0xab],
    [0x15 0x45 0x54 0x55 0x56 0x59 0x5a 0x65 0x69 0x6a 0x95 0x99 0x9a 0xa9 0xaa],
    [0x05 0x15 0x45 0x55 0x56 0x59 0x5a 0x65 0x66 0x69 0x6a 0x95 0x96 0x99 0x9a 0xaa],
    [0x05 0x15 0x45 0x55 0x56 0x59 0x5a 0x66 0x6a 0x96 0x9a 0xaa],
    [0x05 0x15 0x16 0x45 0x46 0x55 0x56 0x59 0x5a 0x66 0x6a 0x96 0x9a 0xaa 0xab],
    [0x04 0x05 0x14 0x15 0x44 0x45 0x54 0x55 0x59 0x5a 0x69 0x6a 0x99 0x9a 0xa9 0xaa],
    [0x05 0x15 0x45 0x55 0x56 0x59 0x5a 0x69 0x6a 0x99 0x9a 0xaa],
    [0x05 0x15 0x45 0x55 0x56 0x59 0x5a 0x6a 0x9a 0xaa],
    [0x05 0x15 0x16 0x45 0x46 0x55 0x56 0x59 0x5a 0x5b 0x6a 0x9a 0xaa 0xab],
    [0x04 0x15 0x19 0x45 0x49 0x54 0x55 0x58 0x59 0x5a 0x69 0x6a 0x99 0x9a 0xa9 0xaa 0xae],
    [0x05 0x15 0x19 0x45 0x49 0x55 0x56 0x59 0x5a 0x69 0x6a 0x99 0x9a 0xaa 0xae],
    [0x05 0x15 0x19 0x45 0x49 0x55 0x56 0x59 0x5a 0x5e 0x6a 0x9a 0xaa 0xae],
    [0x05 0x15 0x1a 0x45 0x4a 0x55 0x56 0x59 0x5a 0x5b 0x5e 0x6a 0x9a 0xaa 0xab 0xae 0xaf],
    [0x15 0x51 0x54 0x55 0x56 0x59 0x65 0x66 0x69 0x6a 0x95 0xa5 0xa6 0xa9 0xaa],
    [0x11 0x15 0x51 0x55 0x56 0x59 0x5a 0x65 0x66 0x69 0x6a 0x95 0x96 0xa5 0xa6 0xaa],
    [0x11 0x15 0x51 0x55 0x56 0x5a 0x65 0x66 0x6a 0x96 0xa6 0xaa],
    [0x11 0x15 0x16 0x51 0x52 0x55 0x56 0x5a 0x65 0x66 0x6a 0x96 0xa6 0xaa 0xab],
    [0x14 0x15 0x54 0x55 0x56 0x59 0x5a 0x65 0x66 0x69 0x6a 0x95 0x99 0xa5 0xa9 0xaa],
    [0x15 0x55 0x56 0x59 0x5a 0x65 0x66 0x69 0x6a 0x95 0x9a 0xa6 0xa9 0xaa],
    [0x15 0x55 0x56 0x59 0x5a 0x65 0x66 0x69 0x6a 0x96 0x9a 0xa6 0xaa 0xab],
    [0x15 0x16 0x55 0x56 0x5a 0x66 0x6a 0x6b 0x96 0x9a 0xa6 0xaa 0xab],
    [0x14 0x15 0x54 0x55 0x59 0x5a 0x65 0x69 0x6a 0x99 0xa9 0xaa],
    [0x15 0x55 0x56 0x59 0x5a 0x65 0x66 0x69 0x6a 0x99 0x9a 0xa9 0xaa 0xae],
    [0x15 0x55 0x56 0x59 0x5a 0x65 0x66 0x69 0x6a 0x9a 0xaa],
    [0x15 0x16 0x55 0x56 0x59 0x5a 0x66 0x6a 0x6b 0x9a 0xaa 0xab],
    [0x14 0x15 0x19 0x54 0x55 0x58 0x59 0x5a 0x65 0x69 0x6a 0x99 0xa9 0xaa 0xae],
    [0x15 0x19 0x55 0x59 0x5a 0x69 0x6a 0x6e 0x99 0x9a 0xa9 0xaa 0xae],
    [0x15 0x19 0x55 0x56 0x59 0x5a 0x69 0x6a 0x6e 0x9a 0xaa 0xae],
    [0x15 0x1a 0x55 0x56 0x59 0x5a 0x6a 0x6b 0x6e 0x9a 0xaa 0xab 0xae 0xaf],
    [0x10 0x11 0x14 0x15 0x50 0x51 0x54 0x55 0x65 0x66 0x69 0x6a 0xa5 0xa6 0xa9 0xaa],
    [0x11 0x15 0x51 0x55 0x56 0x65 0x66 0x69 0x6a 0xa5 0xa6 0xaa],
    [0x11 0x15 0x51 0x55 0x56 0x65 0x66 0x6a 0xa6 0xaa],
    [0x11 0x15 0x16 0x51 0x52 0x55 0x56 0x65 0x66 0x67 0x6a 0xa6 0xaa 0xab],
    [0x14 0x15 0x54 0x55 0x59 0x65 0x66 0x69 0x6a 0xa5 0xa9 0xaa],
    [0x15 0x55 0x56 0x59 0x5a 0x65 0x66 0x69 0x6a 0xa5 0xa6 0xa9 0xaa 0xba],
    [0x15 0x55 0x56 0x59 0x5a 0x65 0x66 0x69 0x6a 0xa6 0xaa],
    [0x15 0x16 0x55 0x56 0x5a 0x65 0x66 0x6a 0x6b 0xa6 0xaa 0xab],
    [0x14 0x15 0x54 0x55 0x59 0x65 0x69 0x6a 0xa9 0xaa],
    [0x15 0x55 0x56 0x59 0x5a 0x65 0x66 0x69 0x6a 0xa9 0xaa],
    [0x15 0x55 0x56 0x59 0x5a 0x65 0x66 0x69 0x6a 0xaa],
    [0x15 0x16 0x55 0x56 0x59 0x5a 0x65 0x66 0x69 0x6a 0x6b 0xaa 0xab],
    [0x14 0x15 0x19 0x54 0x55 0x58 0x59 0x65 0x69 0x6a 0x6d 0xa9 0xaa 0xae],
    [0x15 0x19 0x55 0x59 0x5a 0x65 0x69 0x6a 0x6e 0xa9 0xaa 0xae],
    [0x15 0x19 0x55 0x56 0x59 0x5a 0x65 0x66 0x69 0x6a 0x6e 0xaa 0xae],
    [0x15 0x55 0x56 0x59 0x5a 0x66 0x69 0x6a 0x6b 0x6e 0x9a 0xaa 0xab 0xae 0xaf],
    [0x10 0x15 0x25 0x51 0x54 0x55 0x61 0x64 0x65 0x66 0x69 0x6a 0xa5 0xa6 0xa9 0xaa 0xba],
    [0x11 0x15 0x25 0x51 0x55 0x56 0x61 0x65 0x66 0x69 0x6a 0xa5 0xa6 0xaa 0xba],
    [0x11 0x15 0x25 0x51 0x55 0x56 0x61 0x65 0x66 0x6a 0x76 0xa6 0xaa 0xba],
    [0x11 0x15 0x26 0x51 0x55 0x56 0x62 0x65 0x66 0x67 0x6a 0x76 0xa6 0xaa 0xab 0xba 0xbb],
    [0x14 0x15 0x25 0x54 0x55 0x59 0x64 0x65 0x66 0x69 0x6a 0xa5 0xa9 0xaa 0xba],
    [0x15 0x25 0x55 0x65 0x66 0x69 0x6a 0x7a 0xa5 0xa6 0xa9 0xaa 0xba],
    [0x15 0x25 0x55 0x56 0x65 0x66 0x69 0x6a 0x7a 0xa6 0xaa 0xba],
    [0x15 0x26 0x55 0x56 0x65 0x66 0x6a 0x6b 0x7a 0xa6 0xaa 0xab 0xba 0xbb],
    [0x14 0x15 0x25 0x54 0x55 0x59 0x64 0x65 0x69 0x6a 0x79 0xa9 0xaa 0xba],
    [0x15 0x25 0x55 0x59 0x65 0x66 0x69 0x6a 0x7a 0xa9 0xaa 0xba],
    [0x15 0x25 0x55 0x56 0x59 0x5a 0x65 0x66 0x69 0x6a 0x7a 0xaa 0xba],
    [0x15 0x55 0x56 0x5a 0x65 0x66 0x69 0x6a 0x6b 0x7a 0xa6 0xaa 0xab 0xba 0xbb],
    [0x14 0x15 0x29 0x54 0x55 0x59 0x65 0x68 0x69 0x6a 0x6d 0x79 0xa9 0xaa 0xae 0xba 0xbe],
    [0x15 0x29 0x55 0x59 0x65 0x69 0x6a 0x6e 0x7a 0xa9 0xaa 0xae 0xba 0xbe],
    [0x15 0x55 0x59 0x5a 0x65 0x66 0x69 0x6a 0x6e 0x7a 0xa9 0xaa 0xae 0xba 0xbe],
    [0x15 0x55 0x56 0x59 0x5a 0x65 0x66 0x69 0x6a 0x6b 0x6e 0x7a 0xaa 0xab 0xae 0xba 0xbf],
    [0x45 0x51 0x54 0x55 0x56 0x59 0x65 0x95 0x96 0x99 0x9a 0xa5 0xa6 0xa9 0xaa],
    [0x41 0x45 0x51 0x55 0x56 0x59 0x5a 0x65 0x66 0x95 0x96 0x99 0x9a 0xa5 0xa6 0xaa],
    [0x41 0x45 0x51 0x55 0x56 0x5a 0x66 0x95 0x96 0x9a 0xa6 0xaa],
    [0x41 0x45 0x46 0x51 0x52 0x55 0x56 0x5a 0x66 0x95 0x96 0x9a 0xa6 0xaa 0xab],
    [0x44 0x45 0x54 0x55 0x56 0x59 0x5a 0x65 0x69 0x95 0x96 0x99 0x9a 0xa5 0xa9 0xaa],
    [0x45 0x55 0x56 0x59 0x5a 0x65 0x6a 0x95 0x96 0x99 0x9a 0xa6 0xa9 0xaa],
    [0x45 0x55 0x56 0x59 0x5a 0x66 0x6a 0x95 0x96 0x99 0x9a 0xa6 0xaa 0xab],
    [0x45 0x46 0x55 0x56 0x5a 0x66 0x6a 0x96 0x9a 0x9b 0xa6 0xaa 0xab],
    [0x44 0x45 0x54 0x55 0x59 0x5a 0x69 0x95 0x99 0x9a 0xa9 0xaa],
    [0x45 0x55 0x56 0x59 0x5a 0x69 0x6a 0x95 0x96 0x99 0x9a 0xa9 0xaa 0xae],
    [0x45 0x55 0x56 0x59 0x5a 0x6a 0x95 0x96 0x99 0x9a 0xaa],
    [0x45 0x46 0x55 0x56 0x59 0x5a 0x6a 0x96 0x9a 0x9b 0xaa 0xab],
    [0x44 0x45 0x49 0x54 0x55 0x58 0x59 0x5a 0x69 0x95 0x99 0x9a 0xa9 0xaa 0xae],
    [0x45 0x49 0x55 0x59 0x5a 0x69 0x6a 0x99 0x9a 0x9e 0xa9 0xaa 0xae],
    [0x45 0x49 0x55 0x56 0x59 0x5a 0x6a 0x99 0x9a 0x9e 0xaa 0xae],
    [0x45 0x4a 0x55 0x56 0x59 0x5a 0x6a 0x9a 0x9b 0x9e 0xaa 0xab 0xae 0xaf],
    [0x50 0x51 0x54 0x55 0x56 0x59 0x65 0x66 0x69 0x95 0x96 0x99 0xa5 0xa6 0xa9 0xaa],
    [0x51 0x55 0x56 0x59 0x65 0x66 0x6a 0x95 0x96 0x9a 0xa5 0xa6 0xa9 0xaa],
    [0x51 0x55 0x56 0x5a 0x65 0x66 0x6a 0x95 0x96 0x9a 0xa5 0xa6 0xaa 0xab],
    [0x51 0x52 0x55 0x56 0x5a 0x66 0x6a 0x96 0x9a 0xa6 0xa7 0xaa 0xab],
    [0x54 0x55 0x56 0x59 0x65 0x69 0x6a 0x95 0x99 0x9a 0xa5 0xa6 0xa9 0xaa],
    [0x55 0x56 0x59 0x5a 0x65 0x66 0x69 0x6a 0x95 0x96 0x99 0x9a 0xa5 0xa6 0xa9 0xaa],
    [0x15 0x45 0x51 0x55 0x56 0x59 0x5a 0x65 0x66 0x6a 0x95 0x96 0x9a 0xa6 0xaa 0xab],
    [0x55 0x56 0x5a 0x66 0x6a 0x96 0x9a 0xa6 0xaa 0xab],
    [0x54 0x55 0x59 0x5a 0x65 0x69 0x6a 0x95 0x99 0x9a 0xa5 0xa9 0xaa 0xae],
    [0x15 0x45 0x54 0x55 0x56 0x59 0x5a 0x65 0x69 0x6a 0x95 0x99 0x9a 0xa9 0xaa 0xae],
    [0x15 0x45 0x55 0x56 0x59 0x5a 0x65 0x66 0x69 0x6a 0x95 0x96 0x99 0x9a 0xa6 0xa9 0xaa 0xab 0xae],
    [0x55 0x56 0x59 0x5a 0x66 0x6a 0x96 0x9a 0xa6 0xaa 0xab],
    [0x54 0x55 0x58 0x59 0x5a 0x69 0x6a 0x99 0x9a 0xa9 0xaa 0xad 0xae],
    [0x55 0x59 0x5a 0x69 0x6a 0x99 0x9a 0xa9 0xaa 0xae],
    [0x55 0x56 0x59 0x5a 0x69 0x6a 0x99 0x9a 0xa9 0xaa 0xae],
    [0x55 0x56 0x59 0x5a 0x6a 0x9a 0xaa 0xab 0xae 0xaf],
    [0x50 0x51 0x54 0x55 0x65 0x66 0x69 0x95 0xa5 0xa6 0xa9 0xaa],
    [0x51 0x55 0x56 0x65 0x66 0x69 0x6a 0x95 0x96 0xa5 0xa6 0xa9 0xaa 0xba],
    [0x51 0x55 0x56 0x65 0x66 0x6a 0x95 0x96 0xa5 0xa6 0xaa],
    [0x51 0x52 0x55 0x56 0x65 0x66 0x6a 0x96 0xa6 0xa7 0xaa 0xab],
    [0x54 0x55 0x59 0x65 0x66 0x69 0x6a 0x95 0x99 0xa5 0xa6 0xa9 0xaa 0xba],
    [0x15 0x51 0x54 0x55 0x56 0x59 0x65 0x66 0x69 0x6a 0x95 0xa5 0xa6 0xa9 0xaa 0xba],
    [0x15 0x51 0x55 0x56 0x59 0x5a 0x65 0x66 0x69 0x6a 0x95 0x96 0x9a 0xa5 0xa6 0xa9 0xaa 0xab 0xba],
    [0x55 0x56 0x5a 0x65 0x66 0x6a 0x96 0x9a 0xa6 0xaa 0xab],
    [0x54 0x55 0x59 0x65 0x69 0x6a 0x95 0x99 0xa5 0xa9 0xaa],
    [0x15 0x54 0x55 0x56 0x59 0x5a 0x65 0x66 0x69 0x6a 0x95 0x99 0x9a 0xa5 0xa6 0xa9 0xaa 0xae 0xba],
    [0x15 0x55 0x56 0x59 0x5a 0x65 0x66 0x69 0x6a 0x9a 0xa6 0xa9 0xaa],
    [0x15 0x55 0x56 0x59 0x5a 0x65 0x66 0x69 0x6a 0x96 0x9a 0xa6 0xaa 0xab],
    [0x54 0x55 0x58 0x59 0x65 0x69 0x6a 0x99 0xa9 0xaa 0xad 0xae],
    [0x55 0x59 0x5a 0x65 0x69 0x6a 0x99 0x9a 0xa9 0xaa 0xae],
    [0x15 0x55 0x56 0x59 0x5a 0x65 0x66 0x69 0x6a 0x99 0x9a 0xa9 0xaa 0xae],
    [0x15 0x55 0x56 0x59 0x5a 0x66 0x69 0x6a 0x9a 0xaa 0xab 0xae 0xaf],
    [0x50 0x51 0x54 0x55 0x61 0x64 0x65 0x66 0x69 0x95 0xa5 0xa6 0xa9 0xaa 0xba],
    [0x51 0x55 0x61 0x65 0x66 0x69 0x6a 0xa5 0xa6 0xa9 0xaa 0xb6 0xba],
    [0x51 0x55 0x56 0x61 0x65 0x66 0x6a 0xa5 0xa6 0xaa 0xb6 0xba],
    [0x51 0x55 0x56 0x62 0x65 0x66 0x6a 0xa6 0xa7 0xaa 0xab 0xb6 0xba 0xbb],
    [0x54 0x55 0x64 0x65 0x66 0x69 0x6a 0xa5 0xa6 0xa9 0xaa 0xb9 0xba],
    [0x55 0x65 0x66 0x69 0x6a 0xa5 0xa6 0xa9 0xaa 0xba],
    [0x55 0x56 0x65 0x66 0x69 0x6a 0xa5 0xa6 0xa9 0xaa 0xba],
    [0x55 0x56 0x65 0x66 0x6a 0xa6 0xaa 0xab 0xba 0xbb],
    [0x54 0x55 0x59 0x64 0x65 0x69 0x6a 0xa5 0xa9 0xaa 0xb9 0xba],
    [0x55 0x59 0x65 0x66 0x69 0x6a 0xa5 0xa6 0xa9 0xaa 0xba],
    [0x15 0x55 0x56 0x59 0x5a 0x65 0x66 0x69 0x6a 0xa5 0xa6 0xa9 0xaa 0xba],
    [0x15 0x55 0x56 0x5a 0x65 0x66 0x69 0x6a 0xa6 0xaa 0xab 0xba 0xbb],
    [0x54 0x55 0x59 0x65 0x68 0x69 0x6a 0xa9 0xaa 0xad 0xae 0xb9 0xba 0xbe],
    [0x55 0x59 0x65 0x69 0x6a 0xa9 0xaa 0xae 0xba 0xbe],
    [0x15 0x55 0x59 0x5a 0x65 0x66 0x69 0x6a 0xa9 0xaa 0xae 0xba 0xbe],
    [0x55 0x56 0x59 0x5a 0x65 0x66 0x69 0x6a 0xaa 0xab 0xae 0xba 0xbf],
    [0x40 0x41 0x44 0x45 0x50 0x51 0x54 0x55 0x95 0x96 0x99 0x9a 0xa5 0xa6 0xa9 0xaa],
    [0x41 0x45 0x51 0x55 0x56 0x95 0x96 0x99 0x9a 0xa5 0xa6 0xaa],
    [0x41 0x45 0x51 0x55 0x56 0x95 0x96 0x9a 0xa6 0xaa],
    [0x41 0x45 0x46 0x51 0x52 0x55 0x56 0x95 0x96 0x97 0x9a 0xa6 0xaa 0xab],
    [0x44 0x45 0x54 0x55 0x59 0x95 0x96 0x99 0x9a 0xa5 0xa9 0xaa],
    [0x45 0x55 0x56 0x59 0x5a 0x95 0x96 0x99 0x9a 0xa5 0xa6 0xa9 0xaa 0xea],
    [0x45 0x55 0x56 0x59 0x5a 0x95 0x96 0x99 0x9a 0xa6 0xaa],
    [0x45 0x46 0x55 0x56 0x5a 0x95 0x96 0x9a 0x9b 0xa6 0xaa 0xab],
    [0x44 0x45 0x54 0x55 0x59 0x95 0x99 0x9a 0xa9 0xaa],
    [0x45 0x55 0x56 0x59 0x5a 0x95 0x96 0x99 0x9a 0xa9 0xaa],
    [0x45 0x55 0x56 0x59 0x5a 0x95 0x96 0x99 0x9a 0xaa],
    [0x45 0x46 0x55 0x56 0x59 0x5a 0x95 0x96 0x99 0x9a 0x9b 0xaa 0xab],
    [0x44 0x45 0x49 0x54 0x55 0x58 0x59 0x95 0x99 0x9a 0x9d 0xa9 0xaa 0xae],
    [0x45 0x49 0x55 0x59 0x5a 0x95 0x99 0x9a 0x9e 0xa9 0xaa 0xae],
    [0x45 0x49 0x55 0x56 0x59 0x5a 0x95 0x96 0x99 0x9a 0x9e 0xaa 0xae],
    [0x45 0x55 0x56 0x59 0x5a 0x6a 0x96 0x99 0x9a 0x9b 0x9e 0xaa 0xab 0xae 0xaf],
    [0x50 0x51 0x54 0x55 0x65 0x95 0x96 0x99 0xa5 0xa6 0xa9 0xaa],
    [0x51 0x55 0x56 0x65 0x66 0x95 0x96 0x99 0x9a 0xa5 0xa6 0xa9 0xaa 0xea],
    [0x51 0x55 0x56 0x65 0x66 0x95 0x96 0x9a 0xa5 0xa6 0xaa],
    [0x51 0x52 0x55 0x56 0x66 0x95 0x96 0x9a 0xa6 0xa7 0xaa 0xab],
    [0x54 0x55 0x59 0x65 0x69 0x95 0x96 0x99 0x9a 0xa5 0xa6 0xa9 0xaa 0xea],
    [0x45 0x51 0x54 0x55 0x56 0x59 0x65 0x95 0x96 0x99 0x9a 0xa5 0xa6 0xa9 0xaa 0xea],
    [0x45 0x51 0x55 0x56 0x59 0x5a 0x65 0x66 0x6a 0x95 0x96 0x99 0x9a 0xa5 0xa6 0xa9 0xaa 0xab 0xea],
    [0x55 0x56 0x5a 0x66 0x6a 0x95 0x96 0x9a 0xa6 0xaa 0xab],
    [0x54 0x55 0x59 0x65 0x69 0x95 0x99 0x9a 0xa5 0xa9 0xaa],
    [0x45 0x54 0x55 0x56 0x59 0x5a 0x65 0x69 0x6a 0x95 0x96 0x99 0x9a 0xa5 0xa6 0xa9 0xaa 0xae 0xea],
    [0x45 0x55 0x56 0x59 0x5a 0x6a 0x95 0x96 0x99 0x9a 0xa6 0xa9 0xaa],
    [0x45 0x55 0x56 0x59 0x5a 0x66 0x6a 0x95 0x96 0x99 0x9a 0xa6 0xaa 0xab],
    [0x54 0x55 0x58 0x59 0x69 0x95 0x99 0x9a 0xa9 0xaa 0xad 0xae],
    [0x55 0x59 0x5a 0x69 0x6a 0x95 0x99 0x9a 0xa9 0xaa 0xae],
    [0x45 0x55 0x56 0x59 0x5a 0x69 0x6a 0x95 0x96 0x99 0x9a 0xa9 0xaa 0xae],
    [0x45 0x55 0x56 0x59 0x5a 0x6a 0x96 0x99 0x9a 0xaa 0xab 0xae 0xaf],
    [0x50 0x51 0x54 0x55 0x65 0x95 0xa5 0xa6 0xa9 0xaa],
    [0x51 0x55 0x56 0x65 0x66 0x95 0x96 0xa5 0xa6 0xa9 0xaa],
    [0x51 0x55 0x56 0x65 0x66 0x95 0x96 0xa5 0xa6 0xaa],
    [0x51 0x52 0x55 0x56 0x65 0x66 0x95 0x96 0xa5 0xa6 0xa7 0xaa 0xab],
    [0x54 0x55 0x59 0x65 0x69 0x95 0x99 0xa5 0xa6 0xa9 0xaa],
    [0x51 0x54 0x55 0x56 0x59 0x65 0x66 0x69 0x6a 0x95 0x96 0x99 0x9a 0xa5 0xa6 0xa9 0xaa 0xba 0xea],
    [0x51 0x55 0x56 0x65 0x66 0x6a 0x95 0x96 0x9a 0xa5 0xa6 0xa9 0xaa],
    [0x51 0x55 0x56 0x5a 0x65 0x66 0x6a 0x95 0x96 0x9a 0xa5 0xa6 0xaa 0xab],
    [0x54 0x55 0x59 0x65 0x69 0x95 0x99 0xa5 0xa9 0xaa],
    [0x54 0x55 0x59 0x65 0x69 0x6a 0x95 0x99 0x9a 0xa5 0xa6 0xa9 0xaa],
    [0x55 0x56 0x59 0x5a 0x65 0x66 0x69 0x6a 0x95 0x96 0x99 0x9a 0xa5 0xa6 0xa9 0xaa],
    [0x55 0x56 0x59 0x5a 0x65 0x66 0x6a 0x95 0x96 0x9a 0xa6 0xa9 0xaa 0xab],
    [0x54 0x55 0x58 0x59 0x65 0x69 0x95 0x99 0xa5 0xa9 0xaa 0xad 0xae],
    [0x54 0x55 0x59 0x5a 0x65 0x69 0x6a 0x95 0x99 0x9a 0xa5 0xa9 0xaa 0xae],
    [0x55 0x56 0x59 0x5a 0x65 0x69 0x6a 0x95 0x99 0x9a 0xa6 0xa9 0xaa 0xae],
    [0x55 0x56 0x59 0x5a 0x66 0x69 0x6a 0x96 0x99 0x9a 0xa6 0xa9 0xaa 0xab 0xae 0xaf],
    [0x50 0x51 0x54 0x55 0x61 0x64 0x65 0x95 0xa5 0xa6 0xa9 0xaa 0xb5 0xba],
    [0x51 0x55 0x61 0x65 0x66 0x95 0xa5 0xa6 0xa9 0xaa 0xb6 0xba],
    [0x51 0x55 0x56 0x61 0x65 0x66 0x95 0x96 0xa5 0xa6 0xaa 0xb6 0xba],
    [0x51 0x55 0x56 0x65 0x66 0x6a 0x96 0xa5 0xa6 0xa7 0xaa 0xab 0xb6 0xba 0xbb],
    [0x54 0x55 0x64 0x65 0x69 0x95 0xa5 0xa6 0xa9 0xaa 0xb9 0xba],
    [0x55 0x65 0x66 0x69 0x6a 0x95 0xa5 0xa6 0xa9 0xaa 0xba],
    [0x51 0x55 0x56 0x65 0x66 0x69 0x6a 0x95 0x96 0xa5 0xa6 0xa9 0xaa 0xba],
    [0x51 0x55 0x56 0x65 0x66 0x6a 0x96 0xa5 0xa6 0xaa 0xab 0xba 0xbb],
    [0x54 0x55 0x59 0x64 0x65 0x69 0x95 0x99 0xa5 0xa9 0xaa 0xb9 0xba],
    [0x54 0x55 0x59 0x65 0x66 0x69 0x6a 0x95 0x99 0xa5 0xa6 0xa9 0xaa 0xba],
    [0x55 0x56 0x59 0x65 0x66 0x69 0x6a 0x95 0x9a 0xa5 0xa6 0xa9 0xaa 0xba],
    [0x55 0x56 0x5a 0x65 0x66 0x69 0x6a 0x96 0x9a 0xa5 0xa6 0xa9 0xaa 0xab 0xba 0xbb],
    [0x54 0x55 0x59 0x65 0x69 0x6a 0x99 0xa5 0xa9 0xaa 0xad 0xae 0xb9 0xba 0xbe],
    [0x54 0x55 0x59 0x65 0x69 0x6a 0x99 0xa5 0xa9 0xaa 0xae 0xba 0xbe],
    [0x55 0x59 0x5a 0x65 0x66 0x69 0x6a 0x99 0x9a 0xa5 0xa6 0xa9 0xaa 0xae 0xba 0xbe],
    [0x55 0x56 0x59 0x5a 0x65 0x66 0x69 0x6a 0x9a 0xa6 0xa9 0xaa 0xab 0xae 0xba],
    [0x40 0x45 0x51 0x54 0x55 0x85 0x91 0x94 0x95 0x96 0x99 0x9a 0xa5 0xa6 0xa9 0xaa 0xea],
    [0x41 0x45 0x51 0x55 0x56 0x85 0x91 0x95 0x96 0x99 0x9a 0xa5 0xa6 0xaa 0xea],
    [0x41 0x45 0x51 0x55 0x56 0x85 0x91 0x95 0x96 0x9a 0xa6 0xaa 0xd6 0xea],
    [0x41 0x45 0x51 0x55 0x56 0x86 0x92 0x95 0x96 0x97 0x9a 0xa6 0xaa 0xab 0xd6 0xea 0xeb],
    [0x44 0x45 0x54 0x55 0x59 0x85 0x94 0x95 0x96 0x99 0x9a 0xa5 0xa9 0xaa 0xea],
    [0x45 0x55 0x85 0x95 0x96 0x99 0x9a 0xa5 0xa6 0xa9 0xaa 0xda 0xea],
    [0x45 0x55 0x56 0x85 0x95 0x96 0x99 0x9a 0xa6 0xaa 0xda 0xea],
    [0x45 0x55 0x56 0x86 0x95 0x96 0x9a 0x9b 0xa6 0xaa 0xab 0xda 0xea 0xeb],
    [0x44 0x45 0x54 0x55 0x59 0x85 0x94 0x95 0x99 0x9a 0xa9 0xaa 0xd9 0xea],
    [0x45 0x55 0x59 0x85 0x95 0x96 0x99 0x9a 0xa9 0xaa 0xda 0xea],
    [0x45 0x55 0x56 0x59 0x5a 0x85 0x95 0x96 0x99 0x9a 0xaa 0xda 0xea],
    [0x45 0x55 0x56 0x5a 0x95 0x96 0x99 0x9a 0x9b 0xa6 0xaa 0xab 0xda 0xea 0xeb],
    [0x44 0x45 0x54 0x55 0x59 0x89 0x95 0x98 0x99 0x9a 0x9d 0xa9 0xaa 0xae 0xd9 0xea 0xee],
    [0x45 0x55 0x59 0x89 0x95 0x99 0x9a 0x9e 0xa9 0xaa 0xae 0xda 0xea 0xee],
    [0x45 0x55 0x59 0x5a 0x95 0x96 0x99 0x9a 0x9e 0xa9 0xaa 0xae 0xda 0xea 0xee],
    [0x45 0x55 0x56 0x59 0x5a 0x95 0x96 0x99 0x9a 0x9b 0x9e 0xaa 0xab 0xae 0xda 0xea 0xef],
    [0x50 0x51 0x54 0x55 0x65 0x91 0x94 0x95 0x96 0x99 0xa5 0xa6 0xa9 0xaa 0xea],
    [0x51 0x55 0x91 0x95 0x96 0x99 0x9a 0xa5 0xa6 0xa9 0xaa 0xe6 0xea],
    [0x51 0x55 0x56 0x91 0x95 0x96 0x9a 0xa5 0xa6 0xaa 0xe6 0xea],
    [0x51 0x55 0x56 0x92 0x95 0x96 0x9a 0xa6 0xa7 0xaa 0xab 0xe6 0xea 0xeb],
    [0x54 0x55 0x94 0x95 0x96 0x99 0x9a 0xa5 0xa6 0xa9 0xaa 0xe9 0xea],
    [0x55 0x95 0x96 0x99 0x9a 0xa5 0xa6 0xa9 0xaa 0xea],
    [0x55 0x56 0x95 0x96 0x99 0x9a 0xa5 0xa6 0xa9 0xaa 0xea],
    [0x55 0x56 0x95 0x96 0x9a 0xa6 0xaa 0xab 0xea 0xeb],
    [0x54 0x55 0x59 0x94 0x95 0x99 0x9a 0xa5 0xa9 0xaa 0xe9 0xea],
    [0x55 0x59 0x95 0x96 0x99 0x9a 0xa5 0xa6 0xa9 0xaa 0xea],
    [0x45 0x55 0x56 0x59 0x5a 0x95 0x96 0x99 0x9a 0xa5 0xa6 0xa9 0xaa 0xea],
    [0x45 0x55 0x56 0x5a 0x95 0x96 0x99 0x9a 0xa6 0xaa 0xab 0xea 0xeb],
    [0x54 0x55 0x59 0x95 0x98 0x99 0x9a 0xa9 0xaa 0xad 0xae 0xe9 0xea 0xee],
    [0x55 0x59 0x95 0x99 0x9a 0xa9 0xaa 0xae 0xea 0xee],
    [0x45 0x55 0x59 0x5a 0x95 0x96 0x99 0x9a 0xa9 0xaa 0xae 0xea 0xee],
    [0x55 0x56 0x59 0x5a 0x95 0x96 0x99 0x9a 0xaa 0xab 0xae 0xea 0xef],
    [0x50 0x51 0x54 0x55 0x65 0x91 0x94 0x95 0xa5 0xa6 0xa9 0xaa 0xe5 0xea],
    [0x51 0x55 0x65 0x91 0x95 0x96 0xa5 0xa6 0xa9 0xaa 0xe6 0xea],
    [0x51 0x55 0x56 0x65 0x66 0x91 0x95 0x96 0xa5 0xa6 0xaa 0xe6 0xea],
    [0x51 0x55 0x56 0x66 0x95 0x96 0x9a 0xa5 0xa6 0xa7 0xaa 0xab 0xe6 0xea 0xeb],
    [0x54 0x55 0x65 0x94 0x95 0x99 0xa5 0xa6 0xa9 0xaa 0xe9 0xea],
    [0x55 0x65 0x95 0x96 0x99 0x9a 0xa5 0xa6 0xa9 0xaa 0xea],
    [0x51 0x55 0x56 0x65 0x66 0x95 0x96 0x99 0x9a 0xa5 0xa6 0xa9 0xaa 0xea],
    [0x51 0x55 0x56 0x66 0x95 0x96 0x9a 0xa5 0xa6 0xaa 0xab 0xea 0xeb],
    [0x54 0x55 0x59 0x65 0x69 0x94 0x95 0x99 0xa5 0xa9 0xaa 0xe9 0xea],
    [0x54 0x55 0x59 0x65 0x69 0x95 0x96 0x99 0x9a 0xa5 0xa6 0xa9 0xaa 0xea],
    [0x55 0x56 0x59 0x65 0x6a 0x95 0x96 0x99 0x9a 0xa5 0xa6 0xa9 0xaa 0xea],
    [0x55 0x56 0x5a 0x66 0x6a 0x95 0x96 0x99 0x9a 0xa5 0xa6 0xa9 0xaa 0xab 0xea 0xeb],
    [0x54 0x55 0x59 0x69 0x95 0x99 0x9a 0xa5 0xa9 0xaa 0xad 0xae 0xe9 0xea 0xee],
    [0x54 0x55 0x59 0x69 0x95 0x99 0x9a 0xa5 0xa9 0xaa 0xae 0xea 0xee],
    [0x55 0x59 0x5a 0x69 0x6a 0x95 0x96 0x99 0x9a 0xa5 0xa6 0xa9 0xaa 0xae 0xea 0xee],
    [0x55 0x56 0x59 0x5a 0x6a 0x95 0x96 0x99 0x9a 0xa6 0xa9 0xaa 0xab 0xae 0xea],
    [0x50 0x51 0x54 0x55 0x65 0x95 0xa1 0xa4 0xa5 0xa6 0xa9 0xaa 0xb5 0xba 0xe5 0xea 0xfa],
    [0x51 0x55 0x65 0x95 0xa1 0xa5 0xa6 0xa9 0xaa 0xb6 0xba 0xe6 0xea 0xfa],
    [0x51 0x55 0x65 0x66 0x95 0x96 0xa5 0xa6 0xa9 0xaa 0xb6 0xba 0xe6 0xea 0xfa],
    [0x51 0x55 0x56 0x65 0x66 0x95 0x96 0xa5 0xa6 0xa7 0xaa 0xab 0xb6 0xba 0xe6 0xea 0xfb],
    [0x54 0x55 0x65 0x95 0xa4 0xa5 0xa6 0xa9 0xaa 0xb9 0xba 0xe9 0xea 0xfa],
    [0x55 0x65 0x95 0xa5 0xa6 0xa9 0xaa 0xba 0xea 0xfa],
    [0x51 0x55 0x65 0x66 0x95 0x96 0xa5 0xa6 0xa9 0xaa 0xba 0xea 0xfa],
    [0x55 0x56 0x65 0x66 0x95 0x96 0xa5 0xa6 0xaa 0xab 0xba 0xea 0xfb],
    [0x54 0x55 0x65 0x69 0x95 0x99 0xa5 0xa6 0xa9 0xaa 0xb9 0xba 0xe9 0xea 0xfa],
    [0x54 0x55 0x65 0x69 0x95 0x99 0xa5 0xa6 0xa9 0xaa 0xba 0xea 0xfa],
    [0x55 0x65 0x66 0x69 0x6a 0x95 0x96 0x99 0x9a 0xa5 0xa6 0xa9 0xaa 0xba 0xea 0xfa],
    [0x55 0x56 0x65 0x66 0x6a 0x95 0x96 0x9a 0xa5 0xa6 0xa9 0xaa 0xab 0xba 0xea],
    [0x54 0x55 0x59 0x65 0x69 0x95 0x99 0xa5 0xa9 0xaa 0xad 0xae 0xb9 0xba 0xe9 0xea 0xfe],
    [0x55 0x59 0x65 0x69 0x95 0x99 0xa5 0xa9 0xaa 0xae 0xba 0xea 0xfe],
    [0x55 0x59 0x65 0x69 0x6a 0x95 0x99 0x9a 0xa5 0xa6 0xa9 0xaa 0xae 0xba 0xea],
    [0x55 0x56 0x59 0x5a 0x65 0x66 0x69 0x6a 0x95 0x96 0x99 0x9a 0xa5 0xa6 0xa9 0xaa 0xab 0xae 0xba 0xea],
]

const LATTICE_VERTICES_4D = let
    vertices = Vector{Vertex4D}(undef, 256)
    for i in 0:255
        cx = ((i >> 0) & 3) - 1
        cy = ((i >> 2) & 3) - 1
        cz = ((i >> 4) & 3) - 1
        cw = ((i >> 6) & 3) - 1
        vertices[i+1] = Vertex4D(cx, cy, cz, cw)
    end
    vertices
end

const LOOKUP_4D_A, LOOKUP_4D_B = let
    a = Vector{NTuple{2,Int16}}(undef, 256)
    b = Vector{Vertex4D}(undef, 3476)
    j = 1
    for i in 1:256
        len = length(VERTICES_4D[i])
        a[i] = (j, j + len - 1)
        for k in 1:len
            b[j] = LATTICE_VERTICES_4D[VERTICES_4D[i][k]+1]
            j += 1
        end
    end
    (a, b)
end

"""
    opensimplex2s_4d(; kwargs...)

Construct a sampler that outputs 4-dimensional OpenSimplex2S noise when it is sampled from.

# Arguments

  - `seed=nothing`: An integer used to seed the random number generator for this sampler, or
    `nothing`. If a seed is not supplied, one will be generated automatically which will negatively
    affect reproducibility.

  - `orient=nothing`: One of the following symbols or the value `nothing`:

      + `:x`: The noise space will be re-oriented with the Y axis pointing down the main diagonal to
        improve visual isotropy.

      + `:xy`: Re-orient the noise space to have better visual isotropy in the XY plane.

      + `:xz`: Re-orient the noise space to have better visual isotropy in the XZ plane.

      + `:xyz`: Re-orient the noise space to be better suited for time-varied animations, where the
        W axis is time.

      + `nothing`: Use the standard orientation.
"""
opensimplex2s_4d(; seed=nothing, orient=nothing) = opensimplex2s(4, seed, orient)

@inline transform(::Type{Standard}, x, y, z, w) = (x, y, z, w) .+ SKEW_4D .* (x + y + z + w)

@inline function transform(::Type{ImproveXY}, x, y, z, w)
    xy = x + y
    ww = w * 1.118033988749894
    zw = z * 0.28867513459481294226 + ww
    xr, yr = (x, y) .+ zw .+ xy .* -0.21132486540518699998
    zr = xy * -0.57735026918962599998 + zw
    wr = z * -0.866025403784439 + ww
    (xr, yr, zr, wr)
end

@inline transform(::Type{ImproveXZ}, x, y, z, w) = transform(ImproveXY, x, z, y, w)

@inline function transform(::Type{ImproveXYZ}, x, y, z, w)
    xyz = -(x + y + z)
    ww = w * 1.118033988749894
    s = xyz / 6 + ww
    xs, ys, zs = (x, y, z) .+ s
    ws = xyz * 0.5 + ww
    (xs, ys, zs, ws)
end

@fastpow function sample(sampler::OpenSimplex2S{4,O}, x::T, y::T, z::T, w::T) where {O,T<:Real}
    seed = get_seed(sampler)
    primes = (PRIME_X, PRIME_Y, PRIME_Z, PRIME_W)
    tr = transform(O, x, y, z, w)
    XYZW = floor.(Int, tr)
    XYZWp = XYZW .* primes
    x1, y1, z1, w1 = tr .- XYZW
    vs = (x1, y1, z1, w1) .+ (x1 + y1 + z1 + w1) * UNSKEW_4D
    ix, iy, iz, iw = floor.(Int, (tr .* 4)) .& 3
    index = ix << 0 | iy << 2 | iz << 4 | iw << 6
    result = 0.0
    start, stop = LOOKUP_4D_A[index+1]
    for i in start:stop
        c = LOOKUP_4D_B[i]
        V = XYZWp .+ c.XYZW
        x, y, z, w = vs .+ c.xyzw
        a = (x^2 + y^2) + (z^2 + w^2)
        if a < R²4D
            result += (a - R²4D)^4 * grad(GRADIENTS_4D, seed, V..., x, y, z, w)
        end
    end
    result
end
